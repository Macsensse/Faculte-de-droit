name: Correcteur de fautes

on:
  push:
    branches: [ "main" ]
    paths:
      - "**/*.md"
      - "**/*.txt"
      - "docs/**"

jobs:
  rapport:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Récupérer le dépôt
      - name: Checkout du dépôt
        uses: actions/checkout@v4

      # 2️⃣ Installer Node.js pour cspell
      - name: Installer Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      # 3️⃣ Installer cspell
      - name: Installer cspell
        run: npm install -g cspell

      # 4️⃣ Configurer cspell pour le français et vocabulaire juridique
      - name: Configurer cspell
        run: |
          if [ ! -f cspell.json ]; then
            cat > cspell.json <<'JSON'
            {
              "version": "0.2",
              "language": "fr",
              "dictionaries": ["fr","en"],
              "ignorePaths": [".git","node_modules","**/*.pdf","**/*.png","**/*.jpg"],
              "words": [
                "jurisprudence","pourvoi","cass.","C.civ.","alinéa",
                "L3","TD","UE","droit","arrêt","cons.","CodeCivil","art."
              ]
            }
JSON
          fi

      # 5️⃣ Rapport orthographe avec cspell
      - name: Rapport orthographe (cspell)
        run: |
          echo "=== Rapport cspell ==="
          cspell "**/*.{md,txt}" --no-progress --gitignore --unique || true

      # 6️⃣ Rapport grammaire/conjugaison avec LanguageTool via Docker
      - name: Rapport grammaire/conjugaison (LanguageTool)
        run: |
          echo "=== Rapport LanguageTool ==="
          docker run --rm -v $PWD:/data silviof/docker-languagetool languagetool /data/**/*.md -l fr

